# CourseNotif Context (Current Snapshot)

Last updated: February 20, 2026

## 1) Project identity

- Project name: CourseNotif
- Current stage: Implemented MVP (active development)
- Repository state: Working backend + worker + UI in one Node.js app
- Primary goal: Monitor tracked courses and notify users when open seats become available

## 2) What is currently implemented

1. Data model and persistence
- PostgreSQL schema exists in `db/schema.sql`
- Core tables: `users`, `courses`, `user_courses`, `shared_latest_jsp_file`, `shared_vsb_session`
- DB access layer implemented in `src/db.js`

2. API server
- Express API in `src/apiServer.js`
- Endpoints implemented:
  - `GET /api/health`
  - `POST /api/users/resolve`
  - `GET /api/tracked-courses`
  - `POST /api/tracked-courses`
  - `DELETE /api/tracked-courses/:id`
- `GET /` serves `index.html`

3. Frontend
- Single-page UI in `index.html`
- Supports:
  - set notification email
  - add tracked course by cart ID
  - list tracked courses
  - stop tracking course
- Frontend is connected to `/api/*` (not local-only storage for courses)

4. Monitoring worker
- Worker CLI in `src/worker.js`
- Modes:
  - `--init-login`
  - `--once`
  - default loop
  - `--check-new-course <userId> <cartId>`
- Core monitoring logic in `src/monitorService.js`
- JSP parsing in `src/jspParser.js`

5. VSB source integration
- Source mode selector in `src/config.js`
- Supported modes:
  - `browser` (Playwright automation + capture in `src/vsbBrowserSource.js`)
  - `filesystem`
  - `db`
- Browser mode supports shared login session init and response capture

## 3) What is not done yet

1. Notification delivery
- Email sending is still stubbed in `src/notification.js` (console events only)
- No real provider integration yet (Resend/SendGrid/etc.)

2. Security and auth
- No full auth/account system yet
- Current API ownership model is email-based and lightweight

3. Testing and hardening
- No dedicated unit/integration test suite yet
- Current check is syntax smoke only: `npm run smoke`

4. Operational maturity
- No production-grade observability stack yet (structured logs/metrics/alerting)
- No formal retry/backoff policy for notification delivery failures yet

## 4) Current runbook

1. Install dependencies
- `npm install`
- `npx playwright install chromium`

2. Configure env vars (minimum)
- `DATABASE_URL` is required
- For browser mode: `VSB_SOURCE_MODE=browser`, `VSB_URL`, selectors as needed

3. Apply schema
- `psql "$DATABASE_URL" -f db/schema.sql`

4. Start app
- `npm run web`
- Open `http://localhost:3000`

5. Initialize shared browser session (browser mode)
- `npm run monitor:init-login`

6. Run monitor
- Single pass: `npm run monitor:once`
- Continuous: `npm run monitor:loop`

## 5) Immediate priorities

1. Replace email stubs with real provider integration and delivery logging
2. Add test coverage for parser, monitor logic, and API routes
3. Improve auth/access control for tracked-course operations
4. Harden session lifecycle behavior and failure recovery
5. Add basic production observability and operational safeguards

## 6) Notes for future contributors/agents

- Treat this file as the source of truth for current implementation status.
- `docs/ROADMAP.md` can still guide medium-term planning, but implementation has already started.
- Keep docs aligned with code after each major change.
